{% extends "index.html" %} {% block content %}
<div
  class="auth-wrap container d-flex align-items-center justify-content-center py-5"
>
  <div
    class="auth-card shadow-lg border-0 rounded-4 p-4 p-md-5"
    style="max-width: 560px; width: 100%; background: var(--card-bg, #fffef9)"
  >
    <!-- Brand / Title -->
    <div class="text-center mb-4">
      <h2
        class="title-font fw-bold mb-2"
        style="color: var(--primary, #2e4a38)"
      >
        Create your Account
      </h2>
      <p class="mb-0" style="color: #5f6b66">
        Join our premium marketplace and start your journey.
      </p>
    </div>

    <!-- Alerts (Django form errors) -->
    {% if user_form.non_field_errors %}
    <div class="alert alert-danger small">{{ user_form.non_field_errors }}</div>
    {% endif %}

    <!-- Registration Form -->
    <form method="post" novalidate id="register-form">
      {% csrf_token %}
      
      <!-- Role selection -->
      <div class="mb-3">
        <label class="fw-semibold" style="color: var(--primary, #2e4a38)"
          >Register as</label
        >
        <div class="d-flex gap-4 mt-2">
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="role"
              id="role_buyer"
              value="buyer"
              checked
            />
            <label class="form-check-label" for="role_buyer">Buyer</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="role"
              id="role_seller"
              value="seller"
            />
            <label class="form-check-label" for="role_seller">Seller</label>
          </div>
        </div>
      </div>

      <!-- Buyer Fields -->
      <div id="buyer-fields">
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Username</label>
          {{ user_form.username }}
          {% if user_form.username.errors %}
          <div class="text-danger small">{{ user_form.username.errors }}</div>
          {% endif %}
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="fw-semibold" style="color: var(--primary, #2e4a38)">First Name</label>
            {{ user_form.first_name }}
          </div>
          <div class="col-md-6 mb-3">
            <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Last Name</label>
            {{ user_form.last_name }}
          </div>
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Email</label>
          {{ user_form.email }}
          {% if user_form.email.errors %}
          <div class="text-danger small">{{ user_form.email.errors }}</div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Password</label>
          {{ user_form.password }}
          {% if user_form.password.errors %}
          <div class="text-danger small">{{ user_form.password.errors }}</div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Confirm Password</label>
          {{ user_form.password2 }}
          {% if user_form.password2.errors %}
          <div class="text-danger small">{{ user_form.password2.errors }}</div>
          {% endif %}
        </div>
      </div>

      <!-- Seller Fields (hidden by default) -->
      <div id="seller-fields" style="display: none;">
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">First Name</label>
          <input type="text" name="first_name" class="form-control" placeholder="First Name">
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Last Name</label>
          <input type="text" name="last_name" class="form-control" placeholder="Last Name">
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Email</label>
          <input type="email" name="email" class="form-control" placeholder="you@example.com" required>
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Password</label>
          <input type="password" name="password" class="form-control" placeholder="Create a password" required>
        </div>
        <div class="mb-3">
          <label class="fw-semibold" style="color: var(--primary, #2e4a38)">Shop Name</label>
          {{ seller_form.shop_name }}
          {% if seller_form.shop_name.errors %}
          <div class="text-danger small">{{ seller_form.shop_name.errors }}</div>
          {% endif %}
        </div>
      </div>

      <!-- Password helpers (works if your form contains a 'password' and an optional 'password2') -->
      <div class="d-flex justify-content-between align-items-center mt-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="show-pass" />
          <label class="form-check-label small" for="show-pass"
            >Show password</label
          >
        </div>
        <span class="small text-muted">Minimum 8 characters recommended</span>
      </div>

      <!-- Submit -->
      <button
        type="submit"
        class="btn w-100 py-2 rounded-pill fw-semibold mt-4 premium-btn"
        style="
          background: linear-gradient(135deg, var(--accent, #d4af37), #f4c32f);
          border: none;
        "
      >
        Create Account
      </button>

      <!-- Divider -->
      <div class="divider my-4 d-flex align-items-center">
        <span class="line flex-grow-1"></span>
        <span class="px-3 small text-muted">or</span>
        <span class="line flex-grow-1"></span>
      </div>

      <!-- Login Link -->
      <div class="text-center">
        <p class="mb-0">
          Already have an account?
          <a
            href="{% url 'login' %}"
            class="fw-semibold"
            style="color: var(--primary, #2e4a38); text-decoration: underline"
          >
            Sign in
          </a>
        </p>
      </div>
    </form>
  </div>
</div>

<style>
  /* Keep in-theme with your site variables */
  .auth-card {
    box-shadow: 0 12px 30px rgba(46, 74, 56, 0.12) !important;
  }
  .form-grid p {
    margin-bottom: 1rem;
  }
  .form-grid p > label {
    display: inline-block;
    margin-bottom: 0.35rem;
    font-weight: 600;
    color: var(--primary, #2e4a38);
    font-size: 0.95rem;
  }
  .form-grid p > input,
  .form-grid p > select,
  .form-grid p > textarea {
    width: 100%;
    border: 1px solid #e5eadf;
    background: #fff;
    padding: 0.8rem 0.9rem;
    border-radius: 14px;
    outline: none;
    transition: box-shadow 0.2s ease, border-color 0.2s ease;
  }
  .form-grid p > input:focus,
  .form-grid p > select:focus,
  .form-grid p > textarea:focus {
    border-color: var(--accent, #d4af37);
    box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.15);
  }
  .form-grid .helptext,
  .form-grid ul.errorlist {
    display: block;
    font-size: 0.85rem;
    margin-top: 0.35rem;
  }
  .form-grid ul.errorlist {
    list-style: none;
    padding-left: 0;
    color: #a61d24;
    font-weight: 600;
  }
  .divider .line {
    height: 1px;
    background: #e7eadf;
    display: inline-block;
  }
  /* Hide seller block initially via JS if needed; CSS fallback below */
  #seller-block[hidden] {
    display: none;
  }
</style>

<script>
  (function () {
    // Role switching logic
    const buyerRadio = document.getElementById('role_buyer');
    const sellerRadio = document.getElementById('role_seller');
    const buyerFields = document.getElementById('buyer-fields');
    const sellerFields = document.getElementById('seller-fields');
    
    function toggleFields() {
      if (sellerRadio.checked) {
        buyerFields.style.display = 'none';
        sellerFields.style.display = 'block';
      } else {
        buyerFields.style.display = 'block';
        sellerFields.style.display = 'none';
      }
    }
    
    buyerRadio.addEventListener('change', toggleFields);
    sellerRadio.addEventListener('change', toggleFields);
    
    // Initialize
    toggleFields();

    // Show/Hide password behavior:
    // We try to detect a password input by common IDs/names.
    const showPass = document.getElementById("show-pass");
    if (showPass) {
      showPass.addEventListener("change", () => {
        const passInputs = Array.from(
          document.querySelectorAll(
            'input[type="password"], input[data-password="true"]'
          )
        );
        passInputs.forEach((inp) => {
          // toggle type safely
          try {
            inp.type = showPass.checked ? "text" : "password";
          } catch (e) {}
        });
      });
    }

    // If you include a confirm password field (e.g., name="password2"), do a quick client-side match check.
    const form = document.getElementById("register-form");
    form &&
      form.addEventListener("submit", (e) => {
        const pwd = document.querySelector('input[name="password"]');
        const pwd2 = document.querySelector('input[name="password2"]');
        if (pwd && pwd2 && pwd.value !== pwd2.value) {
          e.preventDefault();
          alert("Passwords do not match.");
          pwd2.focus();
        }
      });

    // Add placeholders for a familiar UX if your Django widgets don't have them
    const setPh = (name, ph) => {
      const el = document.querySelector(`[name="${name}"]`);
      if (el && !el.placeholder) el.placeholder = ph;
    };
    setPh("username", "Choose a username");
    setPh("email", "you@example.com");
    setPh("password", "Create a password");
    setPh("password2", "Confirm password");
  })();
</script>
{% endblock content %}
